#!/usr/bin/env node

// process.title = 'wowspg';

var program = require('commander');
var fs = require('fs');
var spgbuilder = require('../src/spgbuilder.js');

program
  .version('0.0.1')
  .option('-b, --base [type]', 'base folder path')
  .option('-ld, --leftdelimiter [type]', 'template\'s left delimiter')
  .option('-rd, --rightdelimiter [type]', 'template\'s right delimiter')
  .option('-d, --dist [type]', 'template\'s dist folder')
  .option('-t, --target [type]', 'router config file to generate')
  .option('-c, --config [type]', 'the config file')
  .parse(process.argv);


var router = program.router || 'package.json';
var routerConfig = {};
var entrance = [];
if (!fs.existsSync(router)){
    throw new Error('Router\'s config file is not exist');
} else{
    var packageContent = fs.readFileSync(router, {
        encoding: 'utf8'
    });
    var config = JSON.parse(packageContent);
    routerConfig = config.router;
    entrance = config.entrance;
}

spgbuilder.compile({
    base: program.base,
    ext: program.ext,
    ld: program.leftdelimiter,
    rd: program.rightdelimiter,
    dist: program.dist,
    target: program.target,
    config: program.routerConfig,
    entrance: entrance
});